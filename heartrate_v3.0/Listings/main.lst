C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\APP-Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <intrins.h>
   3          
   4          #define uint            unsigned int
   5          #define uchar           unsigned char
   6          #define ulong           unsigned long
   7          #define LCD_DATA        P0                              // å®šä¹‰LCDçš„æ•°æ®ç«¯å£
   8          
   9          // å®šä¹‰ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ä½
  10          sbit LCD_RS =P2^5;      // LCDå‘½ä»¤/æ•°æ®é€‰æ‹©ä½
  11          sbit LCD_RW =P2^6;      // LCDè¯»/å†™é€‰æ‹©ä½
  12          sbit LCD_E  =P2^7;      // LCDä½¿èƒ½ä¿¡å·
  13          
  14          sbit Xintiao =P1^0;     // å¿ƒè·³è¾“å…¥ä¿¡å·
  15          sbit speaker =P2^4;     // èœ‚é¸£å™¨è¾“å‡ºä¿¡å·
  16          
  17          // å»¶æ—¶å‡½æ•°å£°æ˜
  18          void delay5ms(void);
  19          // LCDæ“ä½œå‡½æ•°å£°æ˜
  20          void LCD_WriteData(uchar LCD_1602_DATA);
  21          void LCD_WriteCom(uchar LCD_1602_COM);
  22          void lcd_1602_word(uchar Adress_Com,uchar Num_Adat,uchar *Adress_Data);
  23          void InitLcd(); // LCDåˆå§‹åŒ–
  24          // å®šæ—¶å™¨åˆå§‹åŒ–å‡½æ•°å£°æ˜
  25          void Tim_Init();
  26          
  27          // å…¨å±€å˜é‡å£°æ˜
  28          uchar Xintiao_Change=0;         // å¿ƒè·³è®¡æ•°çŠ¶æ€æ ‡å¿—
  29          uint  Xintiao_Jishu;            // å¿ƒè·³å‘¨æœŸè®¡æ•°å€¼
  30          uchar stop;             // å¿ƒè·³æ£€æµ‹åœæ­¢æ ‡å¿—
  31          uchar View_Data[3];             // æ˜¾ç¤ºæ•°æ®ç¼“å†²åŒº
  32          uchar View_L[3];                // ä½è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  33          uchar View_H[3];                // é«˜è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  34          uchar Xintiao_H=100;            // é«˜è­¦å‘Šé˜ˆå€¼
  35          uchar Xintiao_L=40;             // ä½è­¦å‘Šé˜ˆå€¼
  36          
  37          
  38          uchar Key_Change;               // æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
  39          uchar Key_Value;                // æŒ‰é”®å€¼
  40          uchar View_Con;         // å½“å‰æ˜¾ç¤ºç•Œé¢ç´¢å¼•
  41          uchar View_Change;              // æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
  42          
  43          void main()
  44          {
  45   1              InitLcd();
  46   1              Tim_Init();             // åˆå§‹åŒ–LCDå’Œå®šæ—¶å™¨
  47   1              lcd_1602_word(0x80,16,"Heart Rate:     ");
  48   1              TR0=1;
  49   1              TR1=1;          // å¼€å¯å®šæ—¶å™¨0å’Œå®šæ—¶å™¨1ï¼Œè¿›å…¥ä¸»å¾ªç¯ç›‘æ§æŒ‰é”®è¾“å…¥ä¸å¿ƒè·³é€Ÿç‡ï¼Œå¹¶æ ¹æ®çŠ
             -¶æ€æ›´æ–°æ˜¾ç¤º
  50   1              while(1)
  51   1              {
  52   2                      if(Key_Change)
  53   2                      {
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 2   

  54   3                              Key_Change = 0;         //å¤ä½
  55   3                              View_Change = 1;
  56   3                              switch(Key_Value)
  57   3                              {
  58   4                                      case 1:
  59   4                                      {
  60   5                                              View_Con++;
  61   5                                              if(View_Con == 3)
  62   5                                                      View_Con = 0;
  63   5                                              break;          //0-1-2å¾ªç¯
  64   5                                      }
  65   4                                      case 2:
  66   4                                      {
  67   5                                              if(View_Con == 2)
  68   5                                              {
  69   6                                                      if(Xintiao_H < 150)
  70   6                                                              Xintiao_H++;
  71   6                                              }
  72   5                                              if(View_Con == 1)
  73   5                                              {
  74   6                                                      if(Xintiao_L < Xintiao_H-1)
  75   6                                                              Xintiao_L++;
  76   6                                              }
  77   5                                              break;
  78   5                                      }
  79   4                                      case 3:
  80   4                                      {
  81   5                                              if(View_Con == 2)
  82   5                                              {
  83   6                                                      if(Xintiao_H > Xintiao_L+1)
  84   6                                                              Xintiao_H--;
  85   6                                              }
  86   5                                              if(View_Con == 1)
  87   5                                              {
  88   6                                                      if(Xintiao_L > 30)
  89   6                                                              Xintiao_L--;
  90   6                                              }
  91   5                                              break;
  92   5                                      } 
  93   4                              }
  94   3                      }
  95   2                      if(View_Change)
  96   2                      {
  97   3                              View_Change = 0;
  98   3                              if(stop == 0)
  99   3                              {
 100   4                                      if(View_Data[0] == 0x30)
 101   4                                              View_Data[0] = ' ';
 102   4                              }
 103   3                              else
 104   3                              {
 105   4                                      View_Data[0] = ' ';
 106   4                                      View_Data[1] = ' ';
 107   4                                      View_Data[2] = ' ';
 108   4                              }
 109   3      
 110   3                              switch(View_Con)
 111   3                              {
 112   4                                      case 0:
 113   4                                      {
 114   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 115   5                                              lcd_1602_word(0xc0,16,"                ");
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 3   

 116   5                                              lcd_1602_word(0xcd,3,View_Data);
 117   5                                              break;
 118   5                                      }
 119   4                                      case 1:
 120   4                                      {
 121   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 122   5                                              lcd_1602_word(0x8d,3,View_Data);
 123   5                                 
 124   5                                              View_L[0] = Xintiao_L / 100 + 0x30;
 125   5                                              View_L[1] = Xintiao_L % 100 / 10 + 0x30;
 126   5                                              View_L[2] = Xintiao_L % 10 + 0x30;
 127   5      
 128   5                                              if(View_L[0] == 0x30)
 129   5                                                      View_L[0] = ' ';
 130   5                                 
 131   5                                              lcd_1602_word(0xC0,16,"Warning L :     ");
 132   5                                              lcd_1602_word(0xCd,3,View_L);
 133   5                                              break;
 134   5                                      }
 135   4                                      case 2:
 136   4                                      {
 137   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 138   5                                              lcd_1602_word(0x8d,3,View_Data);
 139   5                                 
 140   5                                              View_H[0] = Xintiao_H / 100 + 0x30;
 141   5                                              View_H[1] = Xintiao_H % 100 / 10 + 0x30;
 142   5                                              View_H[2] = Xintiao_H % 10 + 0x30;
 143   5      
 144   5                                              if(View_H[0] == 0x30)
 145   5                                                      View_H[0] = ' ';
 146   5                                 
 147   5                                              lcd_1602_word(0xC0,16,"Warning H :     ");
 148   5                                              lcd_1602_word(0xCd,3,View_H);
 149   5                                              break;
 150   5                                      }
 151   4                              }
 152   3                      }
 153   2              }
 154   1      }
 155          
 156          void Time1() interrupt 3
 157          {
 158   1              static uchar Key_Con,Xintiao_Con;
 159   1              TH1=0xd8;
 160   1              TL1=0xf0;
 161   1              switch(Key_Con)
 162   1              {
 163   2                      case 0:
 164   2                      {
 165   3                              if((P3 & 0x07) != 0x07)
 166   3                              {
 167   4                                      Key_Con++;
 168   4                              }
 169   3                              break;
 170   3                      }
 171   2                      case 1:
 172   2                      {
 173   3                              if((P3 & 0x07) != 0x07)
 174   3                              {
 175   4                                      Key_Con++;
 176   4                                      switch(P3 & 0x07)
 177   4                                      {
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 4   

 178   5                                              case 0x06: Key_Value = 1; break;
 179   5                                              case 0x05: Key_Value = 2; break;
 180   5                                              case 0x03: Key_Value = 3; break;
 181   5                                      }
 182   4                              }
 183   3                              else
 184   3                              {
 185   4                                      Key_Con = 0;
 186   4                              }
 187   3                              break;
 188   3                      }
 189   2                      case 2:
 190   2                      {
 191   3                              if((P3&0x07) == 0x07)
 192   3                              {
 193   4                                      Key_Change = 1;
 194   4                                      Key_Con = 0;
 195   4                              }
 196   3                              break;
 197   3                      }
 198   2              }
 199   1              
 200   1              switch (Xintiao_Con)
 201   1              {
 202   2                      case 0:
 203   2                      {
 204   3                              if(!Xintiao)
 205   3                              {
 206   4                                      Xintiao_Con++;
 207   4                              }
 208   3                              break;
 209   3                      }
 210   2                      case 1:
 211   2                      {
 212   3                              if(!Xintiao)
 213   3                              {
 214   4                                      Xintiao_Con++;
 215   4                              }
 216   3                              else
 217   3                              {
 218   4                                      Xintiao_Con = 0;
 219   4                              }
 220   3                              break;
 221   3                      }
 222   2                      case 2:
 223   2                      {
 224   3                              if(!Xintiao)
 225   3                              {
 226   4                                      Xintiao_Con++;
 227   4                              }
 228   3                              else
 229   3                              {
 230   4                                      Xintiao_Con = 0;
 231   4                              } 
 232   3                              break;
 233   3                      }
 234   2                      case 3:
 235   2                      {
 236   3                              if(!Xintiao)
 237   3                              {
 238   4                                      Xintiao_Con++;
 239   4                              }
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 5   

 240   3                              else
 241   3                              {
 242   4                                      Xintiao_Con = 0;
 243   4                              } 
 244   3                              break;
 245   3                      }
 246   2                      case 4:
 247   2                      {
 248   3                              if(Xintiao)
 249   3                              {
 250   4                                      if(Xintiao_Change == 1)
 251   4                                      {
 252   5                                              View_Data[0] = (60000 / Xintiao_Jishu) / 100 + 0x30;
 253   5                                              View_Data[1] = (60000 / Xintiao_Jishu) % 100 / 10 + 0x30;
 254   5                                              View_Data[2] = (60000 / Xintiao_Jishu) % 10 + 0x30;
 255   5                                                                                                        
 256   5                                              if(((60000/Xintiao_Jishu)>=Xintiao_H)||((60000/Xintiao_Jishu)<=Xintiao_L))
 257   5                                                      speaker = 0;
 258   5                                              else
 259   5                                                      speaker = 1;
 260   5                                              
 261   5                                              View_Change = 1;
 262   5                                              Xintiao_Jishu = 0;
 263   5                                              Xintiao_Change = 0;
 264   5                                              stop = 0;                       }
 265   4                                      else
 266   4                                      {
 267   5                                              Xintiao_Jishu = 0;
 268   5                                              Xintiao_Change = 1;
 269   5                                      }
 270   4                                      Xintiao_Con = 0;
 271   4                                      break;
 272   4                              }
 273   3                      }
 274   2              }
 275   1      }
 276          
 277          void Time0() interrupt 1
 278          {
 279   1              TH0=0xfc;
 280   1              TL0=0x18;
 281   1              Xintiao_Jishu++;
 282   1              if(Xintiao_Jishu == 5000)
 283   1              {
 284   2                      Xintiao_Jishu = 0;
 285   2                      View_Change = 1;
 286   2                      Xintiao_Change = 0;
 287   2                      stop = 1;
 288   2                      speaker = 1;
 289   2              }
 290   1      }
 291          
 292          void Tim_Init()
 293          {
 294   1              EA = 1;
 295   1              ET0 = 1;
 296   1              ET1 = 1;
 297   1              TMOD = 0x11;
 298   1              TH0 = 0xfc;
 299   1              TL0 = 0x18;
 300   1       
 301   1              TH1 = 0xd8;
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 6   

 302   1              TL1 = 0xf0;
 303   1      }
 304          
 305          void lcd_1602_word(uchar Adress_Com, uchar Num_Adat, uchar *Adress_Data)
 306          {
 307   1              uchar a = 0;
 308   1              uchar Data_Word;
 309   1              LCD_WriteCom(Adress_Com);
 310   1              for(a = 0; a < Num_Adat; a++)
 311   1              {
 312   2                      Data_Word = *Adress_Data;
 313   2                      LCD_WriteData(Data_Word);
 314   2                      Adress_Data++;
 315   2              }
 316   1      }
 317          
 318          /***************1602*******************/
 319          void LCD_WriteData(uchar LCD_1602_DATA)
 320          {
 321   1              delay5ms();
 322   1              LCD_E = 0;
 323   1              LCD_RS = 1;
 324   1              LCD_RW = 0;
 325   1              _nop_();
 326   1              LCD_E = 1;
 327   1              LCD_DATA = LCD_1602_DATA;
 328   1              LCD_E = 0;
 329   1              LCD_RS = 0;
 330   1      }
 331          
 332          
 333          void LCD_WriteCom(uchar LCD_1602_COM)
 334          {
 335   1              delay5ms();
 336   1              LCD_E = 0;
 337   1              LCD_RS = 0;
 338   1              LCD_RW = 0;
 339   1              _nop_();
 340   1              LCD_E = 1;
 341   1              LCD_DATA = LCD_1602_COM;
 342   1              LCD_E = 0;
 343   1              LCD_RS = 0;
 344   1      }
 345          
 346          
 347          void InitLcd()
 348          {
 349   1              delay5ms();
 350   1              delay5ms();
 351   1              LCD_WriteCom(0x38); //display mode
 352   1              LCD_WriteCom(0x38); //display mode
 353   1              LCD_WriteCom(0x38); //display mode
 354   1              LCD_WriteCom(0x06);
 355   1              LCD_WriteCom(0x0c);
 356   1              LCD_WriteCom(0x01);
 357   1              delay5ms();
 358   1              delay5ms();
 359   1      }
 360          
 361          void delay5ms(void)
 362          {
 363   1              unsigned char a,b;
C51 COMPILER V9.60.7.0   MAIN                                                              05/13/2024 23:50:39 PAGE 7   

 364   1              for(b = 185; b > 0; b--)
 365   1                      for(a = 12; a > 0; a--);
 366   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1055    ----
   CONSTANT SIZE    =     68    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
