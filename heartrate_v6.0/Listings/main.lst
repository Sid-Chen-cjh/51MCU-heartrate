C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\APP-Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2           * è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªç®€å•çš„å¿ƒè·³é€Ÿç‡ç›‘æµ‹å’Œè­¦å‘Šç³»ç»Ÿï¼Œä½¿ç”¨äº†LCDæ˜¾ç¤ºå¿ƒç‡æ•°å€¼ä»¥åŠé
             -«˜ä½è­¦å‘Šå€¼ã€‚
   3           * é€šè¿‡æŒ‰é”®å¯ä»¥å¾ªç¯åˆ‡æ¢æ˜¾ç¤ºå½“å‰å¿ƒç‡ã€ä½è­¦å‘Šå€¼å’Œé«˜è­¦å‘Šå€¼ç•Œé¢ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è
             -­¦å‘Šå€¼è¿›è¡Œè®¾ç½®ã€‚
   4           */
   5          #include <REGX52.H>
   6          #include <intrins.h>
   7          
   8          #define uint            unsigned int
   9          #define uchar           unsigned char
  10          #define ulong           unsigned long
  11          #define LCD_DATA        P0                              // å®šä¹‰LCDçš„æ•°æ®ç«¯å£
  12          
  13          // å®šä¹‰ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ä½
  14          sbit LCD_RS =P2^5;      // LCDå‘½ä»¤/æ•°æ®é€‰æ‹©ä½
  15          sbit LCD_RW =P2^6;      // LCDè¯»/å†™é€‰æ‹©ä½
  16          sbit LCD_E  =P2^7;      // LCDä½¿èƒ½ä¿¡å·
  17          
  18          sbit heartrate =P1^0;   // å¿ƒè·³è¾“å…¥ä¿¡å·
  19          sbit buzzer =P2^4;              // èœ‚é¸£å™¨è¾“å‡ºä¿¡å·
  20          
  21          // å»¶æ—¶å‡½æ•°å£°æ˜
  22          void delay5ms(void);
  23          // LCDæ“ä½œå‡½æ•°å£°æ˜
  24          void LCD_WriteData(uchar LCD_1602_DATA);
  25          void LCD_WriteCom(uchar LCD_1602_COM);
  26          void lcd_1602_word(uchar Adress_Com,uchar Num_Adat,uchar *Adress_Data);
  27          void InitLcd(); 
  28          // å®šæ—¶å™¨åˆå§‹åŒ–å‡½æ•°å£°æ˜
  29          void Tim_Init();
  30          // UARTä¸²å£é€šä¿¡åˆå§‹åŒ–å‡½æ•°å£°æ˜
  31          void Uart_Init();
  32          
  33          // å…¨å±€å˜é‡å£°æ˜
  34          uchar heartrate_Change=0;       // å¿ƒè·³è®¡æ•°çŠ¶æ€æ ‡å¿—
  35          uint  heartrate_count;          // å¿ƒè·³å‘¨æœŸè®¡æ•°å€¼
  36          uchar stop;                                     // å¿ƒè·³æ£€æµ‹åœæ­¢æ ‡å¿—
  37          uchar View_Data[3];                     // æ˜¾ç¤ºæ•°æ®ç¼“å†²åŒº
  38          uchar View_L[3];                        // ä½è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  39          uchar View_H[3];                        // é«˜è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  40          uchar heartrate_H=100;          // é«˜è­¦å‘Šé˜ˆå€¼
  41          uchar heartrate_L=40;           // ä½è­¦å‘Šé˜ˆå€¼
  42          
  43          
  44          uchar Key_Change;               // æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
  45          uchar Key_Value;                // æŒ‰é”®å€¼
  46          uchar View_Con;                 // å½“å‰æ˜¾ç¤ºç•Œé¢ç´¢å¼•
  47          uchar View_Change;              // æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
  48          
  49          // ä¸»å‡½æ•°ï¼šåˆå§‹åŒ–LCDå’Œå®šæ—¶å™¨ï¼Œè¿›å…¥ä¸»å¾ªç¯ç›‘æ§æŒ‰é”®è¾“å…¥ä¸å¿ƒè·³é€Ÿç‡ï¼Œå¹¶æ ¹æ®çŠ¶æ
             -€æ›´æ–°æ˜¾ç¤º
  50          void main()
  51          {
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 2   

  52   1              Uart_Init();
  53   1              InitLcd();
  54   1              Tim_Init();             // åˆå§‹åŒ–LCDå’Œå®šæ—¶å™¨
  55   1              lcd_1602_word(0x80,16,"Heart Rate:     ");      // åœ¨LCDä¸Šæ˜¾ç¤ºåˆå§‹ç•Œé¢
  56   1              TR0=1;
  57   1              TR1=1;          // å¼€å¯å®šæ—¶å™¨0å’Œå®šæ—¶å™¨1ï¼Œè¿›å…¥ä¸»å¾ªç¯ç›‘æ§æŒ‰é”®è¾“å…¥ä¸å¿ƒè·³é€Ÿç‡ï¼Œå¹¶æ ¹æ®çŠ
             -¶æ€æ›´æ–°æ˜¾ç¤º
  58   1              while(1)
  59   1              {
  60   2                      // æ£€æµ‹æŒ‰é”®çŠ¶æ€å˜åŒ–ï¼Œå¹¶æ ¹æ®æŒ‰é”®å€¼æ›´æ–°æ˜¾ç¤ºç•Œé¢æˆ–ä¿®æ”¹è­¦å‘Šå€¼
  61   2                      if(Key_Change)
  62   2                      {
  63   3                              Key_Change = 0;         //å¤ä½æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
  64   3                              View_Change = 1;        // è§¦å‘æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
  65   3                              switch(Key_Value)
  66   3                              {
  67   4                                      case 1:
  68   4                                      {
  69   5                                              View_Con++;
  70   5                                              if(View_Con == 3)       // å¦‚æœå½“å‰ç•Œé¢æ˜¯é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢ï¼Œåˆ™å¾ªç¯å›åˆ°ä½è­¦å‘Šå€¼è®¾ç½
             -®ç•Œé¢
  71   5                                                      View_Con = 0;
  72   5                                              break;          //0-1-2å¾ªç¯
  73   5                                      }
  74   4                                      case 2:
  75   4                                      {
  76   5                                              if(View_Con == 2)       // åœ¨é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå¢åŠ é«˜è­¦å‘Šå€¼
  77   5                                              {
  78   6                                                      if(heartrate_H < 150)
  79   6                                                              heartrate_H++;
  80   6                                              }
  81   5                                              if(View_Con == 1)       // åœ¨ä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå¢åŠ ä½è­¦å‘Šå€¼
  82   5                                              {
  83   6                                                      if(heartrate_L < heartrate_H-1)
  84   6                                                              heartrate_L++;
  85   6                                              }
  86   5                                              break;
  87   5                                      }
  88   4                                      case 3:
  89   4                                      {
  90   5                                              if(View_Con == 2)       // åœ¨é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå‡å°‘é«˜è­¦å‘Šå€¼
  91   5                                              {
  92   6                                                      if(heartrate_H > heartrate_L+1)
  93   6                                                              heartrate_H--;
  94   6                                              }
  95   5                                              if(View_Con == 1)        // åœ¨ä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå‡å°‘ä½è­¦å‘Šå€¼
  96   5                                              {
  97   6                                                      if(heartrate_L > 30)
  98   6                                                              heartrate_L--;
  99   6                                              }
 100   5                                              break;
 101   5                                      } 
 102   4                              }
 103   3                      }
 104   2                      // æ ¹æ®æ˜¾ç¤ºæ›´æ–°æ ‡å¿—æ›´æ–°LCDæ˜¾ç¤ºå†…å®¹
 105   2                      if(View_Change)
 106   2                      {
 107   3                              View_Change = 0;        // å¤ä½æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
 108   3                              if(stop == 0)   // å¦‚æœå¿ƒè·³æ£€æµ‹æœªåœæ­¢ï¼Œæ›´æ–°æ˜¾ç¤ºæ•°æ®
 109   3                              {
 110   4                                      if(View_Data[0] == 0x30)
 111   4                                              View_Data[0] = ' ';     // å°†ç©ºæ•°æ®å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 3   

 112   4                              }
 113   3                              else    // å¦‚æœå¿ƒè·³æ£€æµ‹å·²åœæ­¢ï¼Œæ¸…ç©ºæ˜¾ç¤ºæ•°æ®
 114   3                              {
 115   4                                      View_Data[0] = ' ';
 116   4                                      View_Data[1] = ' ';
 117   4                                      View_Data[2] = ' ';
 118   4                              }
 119   3      
 120   3                              switch(View_Con)        // æ ¹æ®å½“å‰æ˜¾ç¤ºç•Œé¢ï¼Œæ›´æ–°ç›¸åº”çš„æ˜¾ç¤ºå†…å®¹
 121   3                              {
 122   4                                      case 0: // å½“å‰æ˜¾ç¤ºå¿ƒç‡ç•Œé¢
 123   4                                      {
 124   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 125   5                                              lcd_1602_word(0xc0,16,"                ");
 126   5                                              lcd_1602_word(0xcd,3,View_Data);
 127   5                                              break;
 128   5                                      }
 129   4                                      case 1:  // å½“å‰æ˜¾ç¤ºä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢
 130   4                                      {
 131   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 132   5                                              lcd_1602_word(0x8d,3,View_Data);
 133   5                                 
 134   5                                              View_L[0] = heartrate_L / 100 + 0x30;   // å°†ä½è­¦å‘Šå€¼è½¬æ¢ä¸ºå­—ç¬¦å½¢å¼
 135   5                                              View_L[1] = heartrate_L % 100 / 10 + 0x30;
 136   5                                              View_L[2] = heartrate_L % 10 + 0x30;
 137   5      
 138   5                                              if(View_L[0] == 0x30)
 139   5                                                      View_L[0] = ' ';        // å¤„ç†ä½è­¦å‘Šå€¼æ˜¾ç¤ºå­—ç¬¦å‰çš„ç©ºå­—ç¬¦
 140   5                                 
 141   5                                              lcd_1602_word(0xC0,16,"Warning L :     ");
 142   5                                              lcd_1602_word(0xCd,3,View_L);
 143   5                                              break;
 144   5                                      }
 145   4                                      case 2: // å½“å‰æ˜¾ç¤ºé«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢
 146   4                                      {
 147   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 148   5                                              lcd_1602_word(0x8d,3,View_Data);
 149   5                                 
 150   5                                              View_H[0] = heartrate_H / 100 + 0x30;   // å°†é«˜è­¦å‘Šå€¼è½¬æ¢ä¸ºå­—ç¬¦å½¢å¼
 151   5                                              View_H[1] = heartrate_H % 100 / 10 + 0x30;
 152   5                                              View_H[2] = heartrate_H % 10 + 0x30;
 153   5      
 154   5                                              if(View_H[0] == 0x30)
 155   5                                                      View_H[0] = ' ';        // å¤„ç†é«˜è­¦å‘Šå€¼æ˜¾ç¤ºå­—ç¬¦å‰çš„ç©ºå­—ç¬¦
 156   5                                 
 157   5                                              lcd_1602_word(0xC0,16,"Warning H :     ");
 158   5                                              lcd_1602_word(0xCd,3,View_H);
 159   5                                              break;
 160   5                                      }
 161   4                              }
 162   3                      }
 163   2              }
 164   1      }
 165          
 166          /* å®šæ—¶å™¨1ä¸­æ–­æœåŠ¡å‡½æ•°ï¼šå¤„ç†æŒ‰é”®è¾“å…¥å’Œå¿ƒè·³æ£€æµ‹ */
 167          void Time1() interrupt 3
 168          {
 169   1              static uchar Key_Con,heartrate_Con;
 170   1              TH1=0xd8;
 171   1              TL1=0xf0;
 172   1              switch(Key_Con)
 173   1              {
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 4   

 174   2                      case 0: // æŒ‰é”®æŒ‰ä¸‹æ£€æµ‹
 175   2                      {
 176   3                              if((P3 & 0x07) != 0x07)
 177   3                              {
 178   4                                      Key_Con++;
 179   4                              }
 180   3                              break;
 181   3                      }
 182   2                      case 1: // ç¡®è®¤æŒ‰é”®æŒ‰ä¸‹
 183   2                      {
 184   3                              if((P3 & 0x07) != 0x07)
 185   3                              {
 186   4                                      Key_Con++;
 187   4                                      switch(P3 & 0x07)       // ç¡®å®šæ˜¯å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹
 188   4                                      {
 189   5                                              case 0x06: Key_Value = 1; break;
 190   5                                              case 0x05: Key_Value = 2; break;
 191   5                                              case 0x03: Key_Value = 3; break;
 192   5                                      }
 193   4                              }
 194   3                              else
 195   3                              {
 196   4                                      Key_Con = 0;
 197   4                              }
 198   3                              break;
 199   3                      }
 200   2                      case 2: // ç­‰å¾…æŒ‰é”®é‡Šæ”¾
 201   2                      {
 202   3                              if((P3&0x07) == 0x07)
 203   3                              {
 204   4                                      Key_Change = 1; // è§¦å‘æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
 205   4                                      Key_Con = 0;
 206   4                              }
 207   3                              break;
 208   3                      }
 209   2              }
 210   1              
 211   1              switch (heartrate_Con)  // å¤„ç†å¿ƒè·³ä¿¡å·è¾“å…¥
 212   1              {
 213   2                      case 0: // ç­‰å¾…å¿ƒè·³ä¿¡å·
 214   2                      {
 215   3                              if(!heartrate)
 216   3                              {
 217   4                                      heartrate_Con++;
 218   4                              }
 219   3                              break;
 220   3                      }
 221   2                      case 1: // ç¡®è®¤å¿ƒè·³ä¿¡å·æœªæ”¶åˆ°
 222   2                      {
 223   3                              if(!heartrate)
 224   3                              {
 225   4                                      heartrate_Con++;
 226   4                              }
 227   3                              else
 228   3                              {
 229   4                                      heartrate_Con = 0;
 230   4                              }
 231   3                              break;
 232   3                      }
 233   2                      case 2: // ç­‰å¾…ä¸‹ä¸€ä¸ªå¿ƒè·³å‘¨æœŸ
 234   2                      {
 235   3                              if(!heartrate)
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 5   

 236   3                              {
 237   4                                      heartrate_Con++;
 238   4                              }
 239   3                              else
 240   3                              {
 241   4                                      heartrate_Con = 0;
 242   4                              } 
 243   3                              break;
 244   3                      }
 245   2                      case 3: // ç­‰å¾…ç¡®è®¤å¿ƒè·³å‘¨æœŸ
 246   2                      {
 247   3                              if(!heartrate)
 248   3                              {
 249   4                                      heartrate_Con++;
 250   4                              }
 251   3                              else
 252   3                              {
 253   4                                      heartrate_Con = 0;
 254   4                              } 
 255   3                              break;
 256   3                      }
 257   2                      case 4:  // å¤„ç†å¿ƒè·³å‘¨æœŸè®¡æ•°å’Œæ›´æ–°æ˜¾ç¤º
 258   2                      {
 259   3                              if(heartrate)
 260   3                              {
 261   4                                      if(heartrate_Change == 1)       // å¦‚æœæ˜¯æ–°çš„å¿ƒè·³å‘¨æœŸ
 262   4                                      {
 263   5                                              View_Data[0] = (60000 / heartrate_count) / 100 + 0x30;  // è®¡ç®—å¹¶è½¬æ¢ä¸ºå­—ç¬¦å½¢å¼
 264   5                                              View_Data[1] = (60000 / heartrate_count) % 100 / 10 + 0x30;
 265   5                                              View_Data[2] = (60000 / heartrate_count) % 10 + 0x30;
 266   5                                                                                                        
 267   5                                              if(((60000/heartrate_count)>=heartrate_H)||((60000/heartrate_count)<=heartrate_L))
 268   5                                                      buzzer = 0;     // å…³é—­èœ‚é¸£å™¨
 269   5                                              else
 270   5                                                      buzzer = 1;
 271   5                                              
 272   5                                              View_Change = 1;
 273   5                                              heartrate_count = 0;
 274   5                                              heartrate_Change = 0;
 275   5                                              stop = 0;                       }
 276   4                                      else
 277   4                                      {
 278   5                                              heartrate_count = 0;
 279   5                                              heartrate_Change = 1;
 280   5                                      }
 281   4                                      heartrate_Con = 0;
 282   4                                      break;
 283   4                              }
 284   3                      }
 285   2              }
 286   1      }
 287          
 288          void Time0() interrupt 1
 289           /* * å‡½æ•°åç§°ï¼šTime0
 290            * æè¿°ï¼šå®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œç”¨äºå®ç°ç‰¹å®šæ—¶é—´é—´éš”çš„ä»»åŠ¡ã€‚
 291            */
 292          {
 293   1              TH0=0xfc;
 294   1              TL0=0x18;
 295   1              heartrate_count++;
 296   1              if(heartrate_count == 5000)
 297   1              {
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 6   

 298   2                      heartrate_count = 0;
 299   2                      View_Change = 1;
 300   2                      heartrate_Change = 0;
 301   2                      stop = 1;
 302   2                      buzzer = 1;
 303   2              }
 304   1      }
 305          
 306          void lcd_1602_word(uchar Adress_Com, uchar Num_Adat, uchar *Adress_Data)
 307          /* * @brief å‘LCD 1602æ˜¾ç¤ºå™¨å‘é€ä¸€ä¸ªæ•°æ®æµ.
 308           * è¯¥å‡½æ•°é€šè¿‡æŒ‡å®šçš„å‘½ä»¤åœ°å€å’Œæ•°æ®åœ°å€ï¼Œå°†æ•°æ®æµæ˜¾ç¤ºåˆ°LCD 1602æ˜¾ç¤ºå™¨.
 309           * * @param Adress_Com å‘½ä»¤åœ°å€ã€‚ç”¨äºæŒ‡å®šLCDè¦æ˜¾ç¤ºçš„ä½ç½®ã€‚
 310           * * @param Num_Adat è¦å‘é€çš„æ•°æ®å­—èŠ‚æ•°ã€‚
 311           * * @param Adress_Data æ•°æ®æŒ‡é’ˆã€‚æŒ‡å‘è¦å‘é€çš„æ•°æ®çš„èµ·å§‹ä½ç½®ã€‚
 312           */
 313          {
 314   1              uchar a = 0;
 315   1              uchar Data_Word;
 316   1              LCD_WriteCom(Adress_Com);
 317   1              for(a = 0; a < Num_Adat; a++)
 318   1              {
 319   2                      Data_Word = *Adress_Data;
 320   2                      LCD_WriteData(Data_Word);
 321   2                      Adress_Data++;
 322   2              }
 323   1      }
 324          
 325          void LCD_WriteData(uchar LCD_1602_DATA)
 326          /* * @brief å‘LCDå†™å…¥æ•°æ®
 327           * è¯¥å‡½æ•°ç”¨äºå‘1602å‹å·çš„LCDå†™å…¥ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚åœ¨å†™å…¥æ•°æ®å‰ï¼Œä¼šå…ˆè¿›è¡Œä¸€ä¸ª
             -5msçš„å»¶æ—¶ï¼Œç„¶åè®¾ç½®LCDçš„ç›¸å…³æ§åˆ¶ä¿¡å·çº¿ï¼Œ
 328           * åŒ…æ‹¬ä½¿èƒ½ä¿¡å·(E)ï¼Œå¯„å­˜å™¨é€‰æ‹©ä¿¡å·(RS)ï¼Œè¯»å†™ä¿¡å·(RW)ï¼Œæœ€åå†™å…¥æ•°æ®å¹¶æ¢å¤æ§åˆ
             -¶ä¿¡å·çº¿çš„çŠ¶æ€ã€‚
 329           * * @param LCD_1602_DATA è¦å†™å…¥LCDçš„æ•°æ®ï¼Œç±»å‹ä¸ºucharï¼ˆæ— ç¬¦å·å­—ç¬¦ï¼‰
 330           */
 331          {
 332   1              delay5ms();             //æ“ä½œå‰çŸ­æš‚å»¶æ—¶ï¼Œä¿è¯ä¿¡å·ç¨³å®š
 333   1              LCD_E = 0;              //ä½¿èƒ½ç½®ä¸ºä½ç”µå¹³
 334   1              LCD_RS = 1;             //å¯„å­˜å™¨é€‰æ‹©ç½®ä¸ºé«˜ç”µå¹³ï¼Œè¡¨ç¤ºä¼ è¾“æ•°æ®å­—èŠ‚
 335   1              LCD_RW = 0;             //è¯»å†™ç½®ä¸ºä½ç”µå¹³,è¡¨ç¤ºå†™å…¥æ•°æ®
 336   1              _nop_();
 337   1              LCD_E = 1;
 338   1              LCD_DATA = LCD_1602_DATA;       //å†™å…¥LCDæ•°æ®
 339   1              LCD_E = 0;
 340   1              LCD_RS = 0;
 341   1      }
 342          
 343          void LCD_WriteCom(uchar LCD_1602_COM)
 344          /* * @brief å‘LCDå†™å…¥å‘½ä»¤
 345           * è¯¥å‡½æ•°ç”¨äºå‘1602å‹å·çš„LCDå†™å…¥æŒ‡å®šçš„å‘½ä»¤ã€‚
 346           * å†™å…¥å‘½ä»¤çš„è¿‡ç¨‹åŒ…æ‹¬ï¼šè®¾ç½®LCDä½¿èƒ½ä¿¡å·ã€è®¾ç½®LCDå‘½ä»¤/æ•°æ®é€‰æ‹©ä¿¡å·ã€
 347           * è®¾ç½®LCDè¯»å†™ä¿¡å·ã€å†™å…¥æ•°æ®å¹¶æ¢å¤åˆå§‹çŠ¶æ€ã€‚
 348           * * @param LCD_1602_COM è¦å†™å…¥LCDçš„å‘½ä»¤å­—èŠ‚
 349           */
 350          {
 351   1              delay5ms();             //æ“ä½œå‰çŸ­æš‚å»¶æ—¶ï¼Œä¿è¯ä¿¡å·ç¨³å®š
 352   1              LCD_E = 0;              //ä½¿èƒ½ç½®ä¸ºä½ç”µå¹³
 353   1              LCD_RS = 0;             //å¯„å­˜å™¨é€‰æ‹©ç½®ä¸ºä½ç”µå¹³ï¼Œè¡¨ç¤ºä¼ è¾“å‘½ä»¤å­—èŠ‚
 354   1              LCD_RW = 0;             //è¯»å†™ç½®ä¸ºä½ç”µå¹³,è¡¨ç¤ºå†™å…¥æ•°æ®
 355   1              _nop_();
 356   1              LCD_E = 1;
 357   1              LCD_DATA = LCD_1602_COM;        //å†™å…¥LCDå‘½ä»¤å­—èŠ‚
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 7   

 358   1              LCD_E = 0;
 359   1              LCD_RS = 0;
 360   1      }
 361          
 362          void InitLcd()
 363          {
 364   1              delay5ms();
 365   1              delay5ms();
 366   1              LCD_WriteCom(0x38);             //å…«ä½æ•°æ®æ¥å£ï¼Œä¸¤è¡Œæ˜¾ç¤ºï¼Œ5*7ç‚¹é˜µ
 367   1              LCD_WriteCom(0x38); 
 368   1              LCD_WriteCom(0x38); 
 369   1              LCD_WriteCom(0x06);                     //æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡å…³ï¼Œé—ªçƒå…³
 370   1              LCD_WriteCom(0x0c);                     //æ•°æ®è¯»å†™æ“ä½œåï¼Œå…‰æ ‡è‡ªåŠ¨åŠ ä¸€ï¼Œç”»é¢ä¸åŠ¨
 371   1              LCD_WriteCom(0x01);                     //å…‰æ ‡å¤ä½ï¼Œæ¸…å±
 372   1              delay5ms();
 373   1              delay5ms();
 374   1      }
 375          
 376          void delay5ms(void)     //@12.000MHz
 377          {
 378   1              unsigned char data i, j;
 379   1      
 380   1              i = 10;
 381   1              j = 183;
 382   1              do
 383   1              {
 384   2                      while (--j);
 385   2              } while (--i);
 386   1      }
 387          
 388          void Uart_Init(void)    //4800bps@12.000MHz
 389          {
 390   1              PCON |= 0x80;           //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 391   1              SCON = 0x50;            //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 392   1              TMOD &= 0x0F;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 393   1              TMOD |= 0x20;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 394   1              TL1 = 0xF3;                     //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 395   1              TH1 = 0xF3;                     //è®¾ç½®å®šæ—¶é‡è½½å€¼
 396   1              ET1 = 0;                        //ç¦æ­¢å®šæ—¶å™¨ä¸­æ–­
 397   1              TR1 = 1;                        //å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶
 398   1              EA = 1;                         //æ€»ä¸­æ–­ä½¿èƒ½
 399   1              ES = 1;                         //æ‰“å¼€RI,TIä¸­æ–­
 400   1      }
 401          
 402          void Tim_Init()
 403          {
 404   1              EA = 1;                         //é…ç½®ä¸­æ–­å¯„å­˜å™¨
 405   1              ET0 = 1;
 406   1              ET2 = 1;
 407   1              TMOD = 0x11;            //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 408   1              TH0 = 0xfc;                     //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 409   1              TL0 = 0x18;
 410   1              TH2 = 0xd8;
 411   1              TL2 = 0xf0;
 412   1              TR0 = 1;                        //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 413   1              TR2 = 1;                        //å®šæ—¶å™¨2å¼€å§‹è®¡æ—¶
 414   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1089    ----
   CONSTANT SIZE    =     68    ----
C51 COMPILER V9.60.7.0   MAIN                                                              05/15/2024 21:58:16 PAGE 8   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
