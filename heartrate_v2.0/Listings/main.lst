C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\APP-Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <intrins.h>
   3          
   4          #define uint            unsigned int
   5          #define uchar           unsigned char
   6          #define ulong           unsigned long
   7          #define LCD_DATA        P0
   8          
   9          sbit LCD_RS =P2^5;
  10          sbit LCD_RW =P2^6;
  11          sbit LCD_E  =P2^7;
  12          
  13          sbit Xintiao =P1^0;
  14          sbit speaker =P2^4;
  15          
  16          void delay5ms(void);
  17          void LCD_WriteData(uchar LCD_1602_DATA);
  18          void LCD_WriteCom(uchar LCD_1602_COM);
  19          void lcd_1602_word(uchar Adress_Com,uchar Num_Adat,uchar *Adress_Data);
  20          void InitLcd();
  21          
  22          void Tim_Init();
  23          
  24          uchar Xintiao_Change=0;
  25          uint  Xintiao_Jishu;
  26          uchar stop;
  27          uchar View_Data[3];
  28          uchar View_L[3];
  29          uchar View_H[3];
  30          uchar Xintiao_H=100;
  31          uchar Xintiao_L=40;
  32          
  33          
  34          uchar Key_Change;
  35          uchar Key_Value;
  36          uchar View_Con;
  37          uchar View_Change;
  38          
  39          void main()
  40          {
  41   1              InitLcd();
  42   1              Tim_Init();
  43   1              lcd_1602_word(0x80,16,"Heart Rate:     ");
  44   1              TR0=1;
  45   1              TR1=1;
  46   1              while(1)
  47   1              {
  48   2                      if(Key_Change)
  49   2                      {
  50   3                              Key_Change=0;
  51   3                              View_Change=1;
  52   3                              switch(Key_Value)
  53   3                              {
  54   4                                      case 1:
C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 2   

  55   4                                      {
  56   5                                              View_Con++;
  57   5                                              if(View_Con==3)
  58   5                                                      View_Con=0;
  59   5                                              break;
  60   5                                      }
  61   4                                      case 2:
  62   4                                      {
  63   5                                              if(View_Con==2)
  64   5                                              {
  65   6                                                      if(Xintiao_H<150)
  66   6                                                              Xintiao_H++;
  67   6                                              }
  68   5                                              if(View_Con==1)
  69   5                                              {
  70   6                                                      if(Xintiao_L<Xintiao_H-1)
  71   6                                                              Xintiao_L++;
  72   6                                              }
  73   5                                              break;
  74   5                                      }
  75   4                                      case 3:
  76   4                                      {
  77   5                                              if(View_Con==2)
  78   5                                              {
  79   6                                                      if(Xintiao_H>Xintiao_L+1)
  80   6                                                              Xintiao_H--;
  81   6                                              }
  82   5                                              if(View_Con==1)
  83   5                                              {
  84   6                                                      if(Xintiao_L>30)
  85   6                                                              Xintiao_L--;
  86   6                                              }
  87   5                                              break;
  88   5                                      } 
  89   4                              }
  90   3                      }
  91   2                      if(View_Change)
  92   2                      {
  93   3                              View_Change=0;
  94   3                              if(stop==0)
  95   3                              {
  96   4                                      if(View_Data[0]==0x30)
  97   4                                              View_Data[0]=' ';
  98   4                              }
  99   3                              else
 100   3                              {
 101   4                                      View_Data[0]=' ';
 102   4                                      View_Data[1]=' ';
 103   4                                      View_Data[2]=' ';
 104   4                              }
 105   3      
 106   3                              switch(View_Con)
 107   3                              {
 108   4                                      case 0:
 109   4                                      {
 110   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 111   5                                              lcd_1602_word(0xc0,16,"                ");
 112   5                                              lcd_1602_word(0xcd,3,View_Data);
 113   5                                              break;
 114   5                                      }
 115   4                                      case 1:
 116   4                                      {
C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 3   

 117   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 118   5                                              lcd_1602_word(0x8d,3,View_Data);
 119   5                                 
 120   5                                              View_L[0] = Xintiao_L / 100 + 0x30;
 121   5                                              View_L[1] = Xintiao_L % 100 / 10 + 0x30;
 122   5                                              View_L[2] = Xintiao_L % 10 + 0x30;
 123   5      
 124   5                                              if(View_L[0]==0x30)
 125   5                                                      View_L[0]=' ';
 126   5                                 
 127   5                                              lcd_1602_word(0xC0,16,"Warning L :     ");
 128   5                                              lcd_1602_word(0xCd,3,View_L);
 129   5                                              break;
 130   5                                      }
 131   4                                      case 2:
 132   4                                      {
 133   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 134   5                                              lcd_1602_word(0x8d,3,View_Data);
 135   5                                 
 136   5                                              View_H[0]=Xintiao_H/100+0x30;
 137   5                                              View_H[1]=Xintiao_H%100/10+0x30;
 138   5                                              View_H[2]=Xintiao_H%10+0x30;
 139   5      
 140   5                                              if(View_H[0]==0x30)
 141   5                                                      View_H[0]=' ';
 142   5                                 
 143   5                                              lcd_1602_word(0xC0,16,"Warning H :     ");
 144   5                                              lcd_1602_word(0xCd,3,View_H);
 145   5                                              break;
 146   5                                      }
 147   4                              }
 148   3                      }
 149   2              }
 150   1      }
 151          
 152          void Time1() interrupt 3
 153          {
 154   1              static uchar Key_Con,Xintiao_Con;
 155   1              TH1=0xd8;
 156   1              TL1=0xf0;
 157   1              switch(Key_Con)
 158   1              {
 159   2                      case 0:
 160   2                      {
 161   3                              if((P3 & 0x07)!=0x07)
 162   3                              {
 163   4                                      Key_Con++;
 164   4                              }
 165   3                              break;
 166   3                      }
 167   2                      case 1:
 168   2                      {
 169   3                              if((P3 & 0x07)!=0x07)
 170   3                              {
 171   4                                      Key_Con++;
 172   4                                      switch(P3 & 0x07)
 173   4                                      {
 174   5                                              case 0x06:Key_Value=1;break;
 175   5                                              case 0x05:Key_Value=2;break;
 176   5                                              case 0x03:Key_Value=3;break;
 177   5                                      }
 178   4                              }
C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 4   

 179   3                              else
 180   3                              {
 181   4                                      Key_Con=0;
 182   4                              }
 183   3                              break;
 184   3                      }
 185   2                      case 2:
 186   2                      {
 187   3                              if((P3&0x07)==0x07)
 188   3                              {
 189   4                                      Key_Change = 1;
 190   4                                      Key_Con = 0;
 191   4                              }
 192   3                              break;
 193   3                      }
 194   2              }
 195   1              
 196   1              switch (Xintiao_Con)
 197   1              {
 198   2                      case 0:
 199   2                      {
 200   3                              if(!Xintiao)
 201   3                              {
 202   4                                      Xintiao_Con++;
 203   4                              }
 204   3                              break;
 205   3                      }
 206   2                      case 1:
 207   2                      {
 208   3                              if(!Xintiao)
 209   3                              {
 210   4                                      Xintiao_Con++;
 211   4                              }
 212   3                              else
 213   3                              {
 214   4                                      Xintiao_Con=0;
 215   4                              }
 216   3                              break;
 217   3                      }
 218   2                      case 2:
 219   2                      {
 220   3                              if(!Xintiao)
 221   3                              {
 222   4                                      Xintiao_Con++;
 223   4                              }
 224   3                              else
 225   3                              {
 226   4                                      Xintiao_Con=0;
 227   4                              } 
 228   3                              break;
 229   3                      }
 230   2                      case 3:
 231   2                      {
 232   3                              if(!Xintiao)
 233   3                              {
 234   4                                      Xintiao_Con++;
 235   4                              }
 236   3                              else
 237   3                              {
 238   4                                      Xintiao_Con=0;
 239   4                              } 
 240   3                              break;
C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 5   

 241   3                      }
 242   2                      case 4:
 243   2                      {
 244   3                              if(Xintiao)
 245   3                              {
 246   4                                      if(Xintiao_Change==1)
 247   4                                      {
 248   5                                              View_Data[0]=(60000/Xintiao_Jishu)/100+0x30;
 249   5                                              View_Data[1]=(60000/Xintiao_Jishu)%100/10+0x30;
 250   5                                              View_Data[2]=(60000/Xintiao_Jishu)%10+0x30;
 251   5                                                                                                        
 252   5                                              if(((60000/Xintiao_Jishu)>=Xintiao_H)||((60000/Xintiao_Jishu)<=Xintiao_L))
 253   5                                              speaker=0;
 254   5                                              else
 255   5                                              speaker=1;
 256   5                                              
 257   5                                              View_Change=1;
 258   5                                              Xintiao_Jishu=0;
 259   5                                              Xintiao_Change=0;
 260   5                                              stop=0;                 }
 261   4                                      else
 262   4                                      {
 263   5                                              Xintiao_Jishu=0;
 264   5                                              Xintiao_Change=1;
 265   5                                      }
 266   4                                      Xintiao_Con=0;
 267   4                                      break;
 268   4                              }
 269   3                      }
 270   2              }
 271   1      }
 272          
 273          void Time0() interrupt 1
 274          {
 275   1              TH0=0xfc;
 276   1              TL0=0x18;
 277   1              Xintiao_Jishu++;
 278   1              if(Xintiao_Jishu==5000)
 279   1              {
 280   2                      Xintiao_Jishu=0;
 281   2                      View_Change=1;
 282   2                      Xintiao_Change=0;
 283   2                      stop=1;
 284   2                      speaker=1;
 285   2              }
 286   1      }
 287          
 288          void Tim_Init()
 289          {
 290   1              EA=1;
 291   1              ET0=1;
 292   1              ET1=1;
 293   1              TMOD=0x11;
 294   1              TH0=0xfc;
 295   1              TL0=0x18;
 296   1       
 297   1              TH1=0xd8;
 298   1              TL1=0xf0;
 299   1      }
 300          
 301          void lcd_1602_word(uchar Adress_Com,uchar Num_Adat,uchar *Adress_Data)
 302          {
C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 6   

 303   1              uchar a=0;
 304   1              uchar Data_Word;
 305   1              LCD_WriteCom(Adress_Com);
 306   1              for(a=0;a<Num_Adat;a++)
 307   1              {
 308   2                      Data_Word=*Adress_Data;
 309   2                      LCD_WriteData(Data_Word);
 310   2                      Adress_Data++;
 311   2              }
 312   1      }
 313          
 314          /***************1602º¯ʽ*******************/
 315          void LCD_WriteData(uchar LCD_1602_DATA)
 316          {
 317   1              delay5ms();
 318   1              LCD_E=0;
 319   1              LCD_RS=1;
 320   1              LCD_RW=0;
 321   1              _nop_();
 322   1              LCD_E=1;
 323   1              LCD_DATA=LCD_1602_DATA;
 324   1              LCD_E=0;
 325   1              LCD_RS=0;
 326   1      }
 327          
 328          /********LCD1602üÁȫ***********/
 329          void LCD_WriteCom(uchar LCD_1602_COM)
 330          {
 331   1              delay5ms();
 332   1              LCD_E=0;
 333   1              LCD_RS=0;
 334   1              LCD_RW=0;
 335   1              _nop_();
 336   1              LCD_E=1;
 337   1              LCD_DATA=LCD_1602_COM;
 338   1              LCD_E=0;
 339   1              LCD_RS=0;
 340   1      }
 341          
 342          
 343          void InitLcd()
 344          {
 345   1              delay5ms();
 346   1              delay5ms();
 347   1              LCD_WriteCom(0x38); //display mode
 348   1              LCD_WriteCom(0x38); //display mode
 349   1              LCD_WriteCom(0x38); //display mode
 350   1              LCD_WriteCom(0x06);
 351   1              LCD_WriteCom(0x0c);
 352   1              LCD_WriteCom(0x01);
 353   1              delay5ms();
 354   1              delay5ms();
 355   1      }
 356          
 357          void delay5ms(void)
 358          {
 359   1              unsigned char a,b;
 360   1              for(b=185;b>0;b--)
 361   1                      for(a=12;a>0;a--);
 362   1      }


C51 COMPILER V9.60.7.0   MAIN                                                              05/12/2024 00:41:16 PAGE 7   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1055    ----
   CONSTANT SIZE    =     68    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
