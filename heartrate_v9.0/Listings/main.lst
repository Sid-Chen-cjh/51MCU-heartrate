C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\APP-Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2           * è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªç®€å•çš„å¿ƒè·³é€Ÿç‡ç›‘æµ‹å’Œè­¦å‘Šç³»ç»Ÿï¼Œä½¿ç”¨äº†LCDæ˜¾ç¤ºå¿ƒç‡æ•°å€¼ä»¥åŠé
             -«˜ä½è­¦å‘Šå€¼ã€‚
   3           * é€šè¿‡æŒ‰é”®å¯ä»¥å¾ªç¯åˆ‡æ¢æ˜¾ç¤ºå½“å‰å¿ƒç‡ã€ä½è­¦å‘Šå€¼å’Œé«˜è­¦å‘Šå€¼ç•Œé¢ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è
             -­¦å‘Šå€¼è¿›è¡Œè®¾ç½®ã€‚
   4           */
   5          #include <REGX52.H>
   6          #include <string.h> 
   7          #include <intrins.h>
   8          
   9          #define uint            unsigned int
  10          #define uchar           unsigned char
  11          #define ulong           unsigned long
  12          #define LCD_DATA        P0                              // å®šä¹‰LCDçš„æ•°æ®ç«¯å£
  13          
  14          // å®šä¹‰ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ä½
  15          sbit LCD_RS =P2^5;      // LCDå‘½ä»¤/æ•°æ®é€‰æ‹©ä½
  16          sbit LCD_RW =P2^6;      // LCDè¯»/å†™é€‰æ‹©ä½
  17          sbit LCD_E  =P2^7;      // LCDä½¿èƒ½ä¿¡å·
  18          
  19          sbit heartrate =P1^0;   // å¿ƒè·³è¾“å…¥ä¿¡å·
  20          sbit buzzer =P2^4;              // èœ‚é¸£å™¨è¾“å‡ºä¿¡å·
  21          
  22          // å»¶æ—¶å‡½æ•°å£°æ˜
  23          void delay5ms(void);
  24          // LCDæ“ä½œå‡½æ•°å£°æ˜
  25          void LCD_WriteData(uchar LCD_1602_DATA);
  26          void LCD_WriteCom(uchar LCD_1602_COM);
  27          void lcd_1602_word(uchar Adress_Com,uchar Num_Adat,uchar *Adress_Data);
  28          void InitLcd(); 
  29          // å®šæ—¶å™¨åˆå§‹åŒ–å‡½æ•°å£°æ˜
  30          void Tim_Init();
  31          // UARTä¸²å£é€šä¿¡å‡½æ•°å£°æ˜
  32          void Uart_Init();
  33          void Uart_SendString(char *str);
  34          
  35          // å…¨å±€å˜é‡å£°æ˜
  36          uchar heartrate_Change=0;       // å¿ƒè·³è®¡æ•°çŠ¶æ€æ ‡å¿—
  37          uint  heartrate_count;          // å¿ƒè·³å‘¨æœŸè®¡æ•°å€¼
  38          uchar stop;                                     // å¿ƒè·³æ£€æµ‹åœæ­¢æ ‡å¿—
  39          uchar View_Data[3];                     // æ˜¾ç¤ºæ•°æ®ç¼“å†²åŒº
  40          uchar View_L[3];                        // ä½è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  41          uchar View_H[3];                        // é«˜è­¦å‘Šå€¼æ˜¾ç¤ºç¼“å†²åŒº
  42          uchar heartrate_H=100;          // é«˜è­¦å‘Šé˜ˆå€¼
  43          uchar heartrate_L=40;           // ä½è­¦å‘Šé˜ˆå€¼
  44          uchar sentence[51];
  45          
  46          uchar Key_Change;               // æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
  47          uchar Key_Value;                // æŒ‰é”®å€¼
  48          uchar View_Con;                 // å½“å‰æ˜¾ç¤ºç•Œé¢ç´¢å¼•
  49          uchar View_Change;              // æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
  50          
  51          // ä¸»å‡½æ•°ï¼šåˆå§‹åŒ–LCDå’Œå®šæ—¶å™¨ï¼Œè¿›å…¥ä¸»å¾ªç¯ç›‘æ§æŒ‰é”®è¾“å…¥ä¸å¿ƒè·³é€Ÿç‡ï¼Œå¹¶æ ¹æ®çŠ¶æ
             -€æ›´æ–°æ˜¾ç¤º
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 2   

  52          void main()
  53          {
  54   1              Uart_Init();
  55   1              InitLcd();
  56   1              Tim_Init();             // åˆå§‹åŒ–LCDå’Œå®šæ—¶å™¨
  57   1              lcd_1602_word(0x80,16,"Heart Rate:     ");      // åœ¨LCDä¸Šæ˜¾ç¤ºåˆå§‹ç•Œé¢
  58   1              TR0=1;
  59   1              TR2=1;          // å¼€å¯å®šæ—¶å™¨0å’Œå®šæ—¶å™¨1ï¼Œè¿›å…¥ä¸»å¾ªç¯ç›‘æ§æŒ‰é”®è¾“å…¥ä¸å¿ƒè·³é€Ÿç‡ï¼Œå¹¶æ ¹æ®çŠ
             -¶æ€æ›´æ–°æ˜¾ç¤º
  60   1              while(1)
  61   1              {
  62   2                      // æ£€æµ‹æŒ‰é”®çŠ¶æ€å˜åŒ–ï¼Œå¹¶æ ¹æ®æŒ‰é”®å€¼æ›´æ–°æ˜¾ç¤ºç•Œé¢æˆ–ä¿®æ”¹è­¦å‘Šå€¼
  63   2                      if(Key_Change)
  64   2                      {
  65   3                              Key_Change = 0;                         // å¤ä½æŒ‰é”®çŠ¶æ€æ”¹å˜æ ‡å¿—
  66   3                              View_Change = 1;                        // è§¦å‘æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
  67   3                              switch(Key_Value)
  68   3                              {
  69   4                                      case 1:                                 //è®¾ç½®é”®æŒ‰ä¸‹
  70   4                                      {
  71   5                                              View_Con++;                     //è®¾ç½®çš„ä½åŠ 
  72   5                                              if(View_Con == 3)       // å¦‚æœå½“å‰ç•Œé¢æ˜¯é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢ï¼Œåˆ™å¾ªç¯å›åˆ°ä½è­¦å‘Šå€¼è®¾ç½
             -®ç•Œé¢
  73   5                                                      View_Con = 0;
  74   5                                              break;                          //è·³å‡ºï¼Œä¸‹åŒ
  75   5                                      }
  76   4                                      case 2:                                 //åŠ é”®æŒ‰ä¸‹
  77   4                                      {
  78   5                                              if(View_Con == 2)       // åœ¨é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå¢åŠ é«˜è­¦å‘Šå€¼
  79   5                                              {
  80   6                                                      if(heartrate_H < 150)
  81   6                                                              heartrate_H++;
  82   6                                              }
  83   5                                              if(View_Con == 1)       // åœ¨ä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå¢åŠ ä½è­¦å‘Šå€¼
  84   5                                              {
  85   6                                                      if(heartrate_L < heartrate_H-1) //ä¸‹é™å€¼å°äºä¸Šé™-1
  86   6                                                              heartrate_L++;
  87   6                                              }
  88   5                                              break;
  89   5                                      }
  90   4                                      case 3:                                 //å‡é”®æŒ‰ä¸‹
  91   4                                      {
  92   5                                              if(View_Con == 2)       // åœ¨é«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå‡å°‘é«˜è­¦å‘Šå€¼
  93   5                                              {
  94   6                                                      if(heartrate_H > heartrate_L+1) //ä¸Šé™æ•°æ®å¤§äºä¸‹é™+1
  95   6                                                              heartrate_H--;
  96   6                                              }
  97   5                                              if(View_Con == 1)        // åœ¨ä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶ï¼Œå‡å°‘ä½è­¦å‘Šå€¼
  98   5                                              {
  99   6                                                      if(heartrate_L > 30)
 100   6                                                              heartrate_L--;
 101   6                                              }
 102   5                                              break;
 103   5                                      } 
 104   4                              }
 105   3                      }
 106   2                      /* æ ¹æ®æ˜¾ç¤ºæ›´æ–°æ ‡å¿—æ›´æ–°LCDæ˜¾ç¤ºå†…å®¹ */
 107   2                      if(View_Change)
 108   2                      {
 109   3                              View_Change = 0;                                // å¤ä½æ˜¾ç¤ºæ›´æ–°æ ‡å¿—
 110   3                              if(stop == 0)                                   // å¦‚æœå¿ƒè·³æ£€æµ‹æ­£å¸¸ï¼Œæ›´æ–°æ˜¾ç¤ºæ•°æ®
 111   3                              {
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 3   

 112   4                                      if(View_Data[0] == 0x30)        // æœ€é«˜ä½ä¸º0æ—¶ä¸æ˜¾ç¤º
 113   4                                              View_Data[0] = ' ';             // å°†ç©ºæ•°æ®å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼
 114   4                              }
 115   3                              else    //è®¡æ•°è¶…è¿‡5000,ä¹Ÿå°±æ˜¯ä¸¤æ¬¡ä¿¡å·æ—¶é—´è¶…è¿‡5s,ä¸æ˜¾ç¤ºæ•°æ®
 116   3                              {
 117   4                                      View_Data[0] = ' ';
 118   4                                      View_Data[1] = ' ';
 119   4                                      View_Data[2] = ' ';
 120   4                              }
 121   3      
 122   3                              switch(View_Con)        // æ ¹æ®å½“å‰æ˜¾ç¤ºç•Œé¢ï¼Œæ›´æ–°ç›¸åº”çš„æ˜¾ç¤ºå†…å®¹
 123   3                              {
 124   4                                      case 0: // æ­£å¸¸æ˜¾ç¤ºå½“å‰å¿ƒç‡ç•Œé¢
 125   4                                      {
 126   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");      //æ˜¾ç¤ºä¸€è¡Œæ•°æ®
 127   5                                              lcd_1602_word(0xc0,16,"                ");      //æ˜¾ç¤ºç¬¬äºŒè¡Œæ•°æ®
 128   5                                              lcd_1602_word(0xcd,3,View_Data);                        //ç¬¬äºŒè¡Œæ˜¾ç¤ºå¿ƒç‡
 129   5                                              break;
 130   5                                      }
 131   4                                      case 1:  // æ˜¾ç¤ºä½è­¦å‘Šå€¼è®¾ç½®ç•Œé¢æ—¶
 132   4                                      {
 133   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");      //ç¬¬ä¸€è¡Œæ˜¾ç¤ºå¿ƒç‡
 134   5                                              lcd_1602_word(0x8d,3,View_Data);
 135   5                                 
 136   5                                              View_L[0] = heartrate_L / 100 + 0x30;           // å°†ä½è­¦å‘Šå€¼è½¬æ¢ä¸ºå­—ç¬¦å½¢å¼
 137   5                                              View_L[1] = heartrate_L % 100 / 10 + 0x30;
 138   5                                              View_L[2] = heartrate_L % 10 + 0x30;
 139   5      
 140   5                                              if(View_L[0] == 0x30)           // æœ€é«˜ä½ä¸º0æ—¶ï¼Œä¸æ˜¾ç¤º
 141   5                                                      View_L[0] = ' ';                // å¤„ç†ä½è­¦å‘Šå€¼æ˜¾ç¤ºå­—ç¬¦å‰çš„ç©ºå­—ç¬¦
 142   5                                 
 143   5                                              lcd_1602_word(0xC0,16,"Warning L :     ");      //ç¬¬äºŒè¡Œæ˜¾ç¤ºä¸‹é™æ•°æ®
 144   5                                              lcd_1602_word(0xCd,3,View_L);
 145   5                                              break;
 146   5                                      }
 147   4                                      case 2: // å½“å‰æ˜¾ç¤ºé«˜è­¦å‘Šå€¼è®¾ç½®ç•Œé¢
 148   4                                      {
 149   5                                              lcd_1602_word(0x80,16,"Heart Rate:     ");
 150   5                                              lcd_1602_word(0x8d,3,View_Data);
 151   5                                 
 152   5                                              View_H[0] = heartrate_H / 100 + 0x30;           // å°†é«˜è­¦å‘Šå€¼è½¬æ¢ä¸ºå­—ç¬¦å½¢å¼
 153   5                                              View_H[1] = heartrate_H % 100 / 10 + 0x30;
 154   5                                              View_H[2] = heartrate_H % 10 + 0x30;
 155   5      
 156   5                                              if(View_H[0] == 0x30)           // æœ€é«˜ä½ä¸º0æ—¶ï¼Œä¸æ˜¾ç¤º
 157   5                                                      View_H[0] = ' ';                // å¤„ç†é«˜è­¦å‘Šå€¼æ˜¾ç¤ºå­—ç¬¦å‰çš„ç©ºå­—ç¬¦
 158   5                                 
 159   5                                              lcd_1602_word(0xC0,16,"Warning H :     ");
 160   5                                              lcd_1602_word(0xCd,3,View_H);
 161   5                                              break;
 162   5                                      }
 163   4                              }
 164   3                      }
 165   2              }
 166   1      }
 167          
 168          /* å®šæ—¶å™¨2ä¸­æ–­æœåŠ¡å‡½æ•°ï¼šå¤„ç†æŒ‰é”®è¾“å…¥å’Œå¿ƒè·³æ£€æµ‹ */
 169          void Time2() interrupt 5
 170          {
 171   1              static uchar Key_Con,heartrate_Con;
 172   1              TH2=0xd8;                       //é‡æ–°èµ‹åˆå€¼,ä½¿å¾—é—´éš”ä¸º10ms
 173   1              TL2=0xf0;
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 4   

 174   1              switch(Key_Con)         //æ— æŒ‰é”®æŒ‰ä¸‹æ—¶æ­¤å€¼ä¸º0
 175   1              {
 176   2                      case 0:                 //æ¯10msæ‰«ææ­¤å¤„
 177   2                      {
 178   3                              if((P3 & 0x07) != 0x07) //æ‰«ææŒ‰é”®æ˜¯å¦æœ‰æŒ‰ä¸‹
 179   3                              {
 180   4                                      Key_Con++;                      //æœ‰æŒ‰ä¸‹æ­¤å€¼åŠ 1ï¼Œå€¼ä¸º1
 181   4                              }
 182   3                              break;
 183   3                      }
 184   2                      case 1:                 //10msåäºŒæ¬¡è¿›å…¥ä¸­æ–­åæ‰«ææ­¤å¤„ï¼ˆKey_Conä¸º1ï¼‰
 185   2                      {
 186   3                              if((P3 & 0x07) != 0x07)         //ç¬¬äºŒæ¬¡è¿›å…¥ä¸­æ–­æ—¶ï¼ŒæŒ‰é”®ä»ç„¶æ˜¯æŒ‰ä¸‹ï¼ˆèµ·åˆ°æŒ‰é”®å»¶æ—¶å»æŠ–ç
             -š„ä½œç”¨ï¼‰
 187   3                              {
 188   4                                      Key_Con++;                              //å˜é‡åŠ 1ï¼Œå€¼ä¸º2
 189   4                                      switch(P3 & 0x07)               //ç¡®å®šæ˜¯å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹
 190   4                                      {
 191   5                                              case 0x06: Key_Value = 1; break;        //åˆ¤æ–­å¥½æŒ‰é”®åå°†é”®å€¼èµ‹å€¼ç»™å˜é‡Key_Value
 192   5                                              case 0x05: Key_Value = 2; break;
 193   5                                              case 0x03: Key_Value = 3; break;
 194   5                                      }
 195   4                              }
 196   3                              else                                            //å¦‚æœ10msæ—¶æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼ˆæŒ‰ä¸‹æ—¶é—´è¿‡çŸ­ï¼‰
 197   3                              {
 198   4                                      Key_Con = 0;                    //å˜é‡æ¸…é›¶ï¼Œé‡æ–°æ£€æµ‹æŒ‰é”®
 199   4                              }
 200   3                              break;
 201   3                      }
 202   2                      case 2:                 //20msåæ£€æµ‹æŒ‰é”®
 203   2                      {
 204   3                              if((P3&0x07) == 0x07)           //æ£€æµ‹æŒ‰é”®æ˜¯å¦è¿˜æ˜¯æŒ‰ä¸‹çŠ¶æ€
 205   3                              {
 206   4                                      Key_Change = 1;                 //æœ‰æŒ‰é”®æŒ‰ä¸‹ä½¿èƒ½å˜é‡ï¼Œï¼ˆæ­¤å˜é‡ä¸º1æ—¶æ‰ä¼šå¤„ç†é”®å€¼æ•°æ®ï¼‰
 207   4                                      Key_Con = 0;                    //å˜é‡æ¸…é›¶ï¼Œç­‰å¾…ä¸‹æ¬¡æœ‰æŒ‰é”®æŒ‰ä¸‹
 208   4                              }
 209   3                              break;
 210   3                      }
 211   2              }
 212   1              
 213   1              switch (heartrate_Con)  // å¤„ç†å¿ƒè·³ä¿¡å·è¾“å…¥
 214   1              {
 215   2                      case 0:         //é»˜è®¤heartrate_Conæ˜¯ä¸º0çš„
 216   2                      {
 217   3                              if(!heartrate)                  //æ¯10msï¼ˆä¸Šé¢çš„å®šæ—¶å™¨ï¼‰æ£€æµ‹ä¸€æ¬¡è„‰ææ˜¯å¦æœ‰ä¿¡å·
 218   3                              {
 219   4                                      heartrate_Con++;        //å¦‚æœæœ‰ä¿¡å·ï¼Œå˜é‡åŠ ä¸€ï¼Œç¨‹åºå°±ä¼šå¾€ä¸‹èµ°äº†
 220   4                              }
 221   3                              break;
 222   3                      }
 223   2                      case 1:         //ç¡®è®¤å¿ƒè·³ä¿¡å·æœªæ”¶åˆ°
 224   2                      {
 225   3                              if(!heartrate)                  //æ¯è¿‡10msæ£€æµ‹ä¸€ä¸‹ä¿¡å·æ˜¯å¦è¿˜å­˜åœ¨
 226   3                              {
 227   4                                      heartrate_Con++;        //å­˜åœ¨å°±åŠ ä¸€
 228   4                              }
 229   3                              else
 230   3                              {
 231   4                                      heartrate_Con = 0;      //å¦‚æœä¸å­˜åœ¨äº†ï¼Œæ£€æµ‹æ—¶é—´å¾ˆçŸ­ï¼Œè¯´æ˜æ£€æµ‹åˆ°çš„ä¸æ˜¯è„‰æä¿¡å·ï¼Œ
             -å¯èƒ½æ˜¯å…¶ä»–å¹²æ‰°ï¼Œå°†å˜é‡æ¸…é›¶ï¼Œè·³å‡ºæ­¤æ¬¡æ£€æµ‹
 232   4                              }
 233   3                              break;
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 5   

 234   3                      }
 235   2                      case 2:         //ç­‰å¾…ä¸‹ä¸€ä¸ªå¿ƒè·³å‘¨æœŸ
 236   2                      {
 237   3                              if(!heartrate)
 238   3                              {
 239   4                                      heartrate_Con++;        //å­˜åœ¨å°±åŠ ä¸€
 240   4                              }
 241   3                              else
 242   3                              {
 243   4                                      heartrate_Con = 0;      //å¦‚æœä¸å­˜åœ¨äº†ï¼Œæ£€æµ‹æ—¶é—´å¾ˆçŸ­ï¼Œè¯´æ˜æ£€æµ‹åˆ°çš„ä¸æ˜¯è„‰æä¿¡å·ï¼Œ
             -å¯èƒ½æ˜¯å…¶ä»–å¹²æ‰°ï¼Œå°†å˜é‡æ¸…é›¶ï¼Œè·³å‡ºæ­¤æ¬¡æ£€æµ‹
 244   4                              } 
 245   3                              break;
 246   3                      }
 247   2                      case 3:         //ç­‰å¾…ç¡®è®¤å¿ƒè·³å‘¨æœŸ
 248   2                      {
 249   3                              if(!heartrate)
 250   3                              {
 251   4                                      heartrate_Con++;        //å­˜åœ¨å°±åŠ ä¸€
 252   4                              }
 253   3                              else
 254   3                              {
 255   4                                      heartrate_Con = 0;      //å¦‚æœä¸å­˜åœ¨äº†ï¼Œæ£€æµ‹æ—¶é—´å¾ˆçŸ­ï¼Œè¯´æ˜æ£€æµ‹åˆ°çš„ä¸æ˜¯è„‰æä¿¡å·ï¼Œ
             -å¯èƒ½æ˜¯å…¶ä»–å¹²æ‰°ï¼Œå°†å˜é‡æ¸…é›¶ï¼Œè·³å‡ºæ­¤æ¬¡æ£€æµ‹
 256   4                              } 
 257   3                              break;
 258   3                      }
 259   2                      case 4:         //å¤„ç†å¿ƒè·³å‘¨æœŸè®¡æ•°å’Œæ›´æ–°æ˜¾ç¤º
 260   2                      {
 261   3                              if(heartrate)//è¶…è¿‡30msæœ‰ä¿¡å·ï¼Œåˆ¤å®šæ­¤æ¬¡æ˜¯è„‰æä¿¡å·ï¼Œç„¶åå½“ä¿¡å·æ¶ˆå¤±åï¼Œæ‰§è¡Œä»¥
             -ä¸‹ç¨‹åº
 262   3                              {
 263   4                                      if(heartrate_Change == 1)//å¿ƒç‡è®¡åŸç†ä¸ºæ£€æµ‹ä¸¤æ¬¡è„‰å†²é—´éš”æ—¶é—´è®¡ç®—å¿ƒç‡ï¼Œå˜é‡heartr
             -ate_Changeç¬¬ä¸€æ¬¡è„‰å†²æ—¶ä¸º0çš„ï¼Œæ‰€æœ‰èµ°ä¸‹é¢çš„elseï¼Œç¬¬äºŒæ¬¡èµ°è¿™é‡Œ
 264   4                                      {
 265   5                                              View_Data[0] = (60000 / heartrate_count) / 100 + 0x30;//è®¡ç®—å¿ƒè·³å¹¶æ‹†å­—æ˜¾ç¤ºï¼šå¿ƒè·³è®¡æ—¶æ˜¯
             -ä»¥1msä¸ºå•ä½ï¼Œä¸¤æ¬¡å¿ƒè·³ä¸­é—´è®¡æ•°å¦‚æœæ˜¯1000æ¬¡ï¼Œä¹Ÿå°±æ˜¯1000*1ms=1000ms=1s
 266   5                                              View_Data[1] = (60000 / heartrate_count) % 100 / 10 + 0x30;//é‚£ä¹ˆè®¡ç®—å‡ºçš„ä¸€åˆ†é’Ÿï¼ˆ60sï¼‰å¿ƒè
             -·³æ•°å°±æ˜¯ï¼š60*1000/ï¼ˆ1000*1msï¼‰=60æ¬¡      å…¶ä¸­60æ˜¯ä¸€åˆ†é’Ÿ60sï¼Œ1000æ˜¯ä¸€ç§’æœ‰1000msï¼Œ1000æ˜¯è®¡æ•°å€¼ï¼Œ1æ˜¯ä
             -¸€æ¬¡è®¡æ•°å¯¹åº” çš„æ—¶é—´æ˜¯1ms
 267   5                                              View_Data[2] = (60000 / heartrate_count) % 10 + 0x30;//è®¡ç®—å‡ºçš„å¿ƒè·³æ•°/100å¾—åˆ°å¿ƒè·³çš„ç™¾ä½
             -ï¼Œ%100æ˜¯å–ä½™çš„ï¼Œå°±æ˜¯é™¤ä»¥100çš„ä½™æ•°ï¼Œå†é™¤ä»¥10å°±å¾—åˆ°åä½äº†ï¼Œä»¥æ­¤ç±»æ¨
 268   5                                              //æ‹†å­—åçš„å•ä¸ªæ•°æ®+0x30çš„ç›®çš„æ˜¯å¾—åˆ°å¯¹åº”æ•°å­—çš„æ¶²æ™¶æ˜¾ç¤ºç ï¼Œæ•°å­—0å¯¹åº”çš„æ¶²
             -æ™¶æ˜¾ç¤ºç æ˜¯0x30ï¼Œ1æ˜¯0x30+1ï¼Œä»¥æ­¤ç±»æ¨                                                         
 269   5                                              if(((60000/heartrate_count)>=heartrate_H)||((60000/heartrate_count)<=heartrate_L))//å¿ƒç‡ä¸åœ¨èŒƒå›
             -´å†…æŠ¥è­¦
 270   5                                              {
 271   6                                                      buzzer = 0;             // èœ‚é¸£å™¨å“
 272   6                                                      strcpy(sentence, "Abnormal heart rate! Current heart rate value is:");
 273   6                                                      Uart_SendString(sentence);
 274   6                                                      Uart_SendString(View_Data);
 275   6                                              }
 276   5                                              else
 277   5                                              {
 278   6                                                      buzzer = 1;             //ä¸å“
 279   6                                                      strcpy(sentence, "Heart rate is normal! Current heart rate value is:");
 280   6                                                      Uart_SendString(sentence);
 281   6                                                      Uart_SendString(View_Data);
 282   6                                              }
 283   5                                              
 284   5                                              View_Change = 1;                //è®¡ç®—å‡ºå¿ƒç‡åå¯åŠ¨æ˜¾ç¤º
 285   5                                              heartrate_count = 0;    //å¿ƒè·³è®¡æ•°æ¸…é›¶
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 6   

 286   5                                              heartrate_Change = 0;   //è®¡ç®—å‡ºå¿ƒç‡åè¯¥å˜é‡æ¸…é›¶ï¼Œå‡†å¤‡ä¸‹æ¬¡æ£€æµ‹å¿ƒç‡
 287   5                                              stop = 0;                               //è®¡ç®—å‡ºå¿ƒç‡åstopæ¸…é›¶
 288   5                                      }
 289   4                                      else    //ç¬¬ä¸€æ¬¡è„‰å†²æ—¶heartrate_Changeä¸º0
 290   4                                      {
 291   5                                              heartrate_count = 0;    //è„‰å†²è®¡æ—¶å˜é‡æ¸…é›¶ï¼Œå¼€å§‹è®¡æ—¶
 292   5                                              heartrate_Change = 1;   //heartrate_Changeç½®1ï¼Œå‡†å¤‡ç¬¬äºŒæ¬¡æ£€æµ‹åˆ°è„‰å†²æ—¶è®¡ç®—å¿ƒç‡
 293   5                                      }
 294   4                                      heartrate_Con = 0;              //æ¸…é›¶ï¼Œå‡†å¤‡æ£€æµ‹ä¸‹ä¸€æ¬¡è„‰å†²
 295   4                                      break;
 296   4                              }
 297   3                      }
 298   2              }
 299   1      }
 300          
 301          /**å®šæ—¶å™¨T0å·¥ä½œå‡½æ•°**/
 302          void Time0() interrupt 1
 303          {
 304   1              TH0=0xfc;               // è®¾ç½®å®šæ—¶å™¨0çš„åˆå€¼,ä½¿å…¶ä¸­æ–­å‘¨æœŸä¸º1ms
 305   1              TL0=0x18;
 306   1              heartrate_count++;
 307   1              if(heartrate_count == 5000)     // æ¯éš”5sï¼Œè¿›è¡Œä¸€æ¬¡çŠ¶æ€æ›´æ–°
 308   1              {
 309   2                      heartrate_count = 0;    // é‡ç½®å¿ƒç‡è®¡æ•°å™¨
 310   2                      View_Change = 1;                // è§¦å‘è§†å›¾æ›´æ–°
 311   2                      heartrate_Change = 0;   // é‡ç½®å¿ƒç‡å˜åŒ–æ ‡å¿—ï¼Œå‡†å¤‡å†æ¬¡æ£€æµ‹
 312   2                      stop = 1;                               // å¿ƒè·³è®¡æ•°è¶…è¿‡5000åè¯´æ˜å¿ƒç‡ä¸æ­£å¸¸æˆ–è€…æ²¡æœ‰æµ‹å‡ºï¼Œstopç½®1
 313   2                      buzzer = 1;                             // å…³é—­èœ‚é¸£å™¨
 314   2              }
 315   1      }
 316          
 317          void lcd_1602_word(uchar Adress_Com, uchar Num_Adat, uchar *Adress_Data)
 318          /* * @brief å‘LCD 1602æ˜¾ç¤ºå™¨å‘é€ä¸€ä¸ªæ•°æ®æµ.
 319           * è¯¥å‡½æ•°é€šè¿‡æŒ‡å®šçš„å‘½ä»¤åœ°å€å’Œæ•°æ®åœ°å€ï¼Œå°†æ•°æ®æµæ˜¾ç¤ºåˆ°LCD 1602æ˜¾ç¤ºå™¨.
 320           * * @param Adress_Com å‘½ä»¤åœ°å€ã€‚ç”¨äºæŒ‡å®šLCDè¦æ˜¾ç¤ºçš„ä½ç½®ã€‚
 321           * * @param Num_Adat è¦å‘é€çš„æ•°æ®å­—èŠ‚æ•°ã€‚
 322           * * @param Adress_Data æ•°æ®æŒ‡é’ˆã€‚æŒ‡å‘è¦å‘é€çš„æ•°æ®çš„èµ·å§‹ä½ç½®ã€‚
 323           */
 324          {
 325   1              uchar a = 0;
 326   1              uchar Data_Word;
 327   1              LCD_WriteCom(Adress_Com);
 328   1              for(a = 0; a < Num_Adat; a++)
 329   1              {
 330   2                      Data_Word = *Adress_Data;
 331   2                      LCD_WriteData(Data_Word);
 332   2                      Adress_Data++;
 333   2              }
 334   1      }
 335          
 336          void LCD_WriteData(uchar LCD_1602_DATA)
 337          /* * @brief å‘LCDå†™å…¥æ•°æ®
 338           * è¯¥å‡½æ•°ç”¨äºå‘1602å‹å·çš„LCDå†™å…¥ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚åœ¨å†™å…¥æ•°æ®å‰ï¼Œä¼šå…ˆè¿›è¡Œä¸€ä¸ª
             -5msçš„å»¶æ—¶ï¼Œç„¶åè®¾ç½®LCDçš„ç›¸å…³æ§åˆ¶ä¿¡å·çº¿ï¼Œ
 339           * åŒ…æ‹¬ä½¿èƒ½ä¿¡å·(E)ï¼Œå¯„å­˜å™¨é€‰æ‹©ä¿¡å·(RS)ï¼Œè¯»å†™ä¿¡å·(RW)ï¼Œæœ€åå†™å…¥æ•°æ®å¹¶æ¢å¤æ§åˆ
             -¶ä¿¡å·çº¿çš„çŠ¶æ€ã€‚
 340           * * @param LCD_1602_DATA è¦å†™å…¥LCDçš„æ•°æ®ï¼Œç±»å‹ä¸ºucharï¼ˆæ— ç¬¦å·å­—ç¬¦ï¼‰
 341           */
 342          {
 343   1              delay5ms();             //æ“ä½œå‰çŸ­æš‚å»¶æ—¶ï¼Œä¿è¯ä¿¡å·ç¨³å®š
 344   1              LCD_E = 0;              //ä½¿èƒ½ç½®ä¸ºä½ç”µå¹³
 345   1              LCD_RS = 1;             //å¯„å­˜å™¨é€‰æ‹©ç½®ä¸ºé«˜ç”µå¹³ï¼Œè¡¨ç¤ºä¼ è¾“æ•°æ®å­—èŠ‚
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 7   

 346   1              LCD_RW = 0;             //è¯»å†™ç½®ä¸ºä½ç”µå¹³,è¡¨ç¤ºå†™å…¥æ•°æ®
 347   1              _nop_();
 348   1              LCD_E = 1;
 349   1              LCD_DATA = LCD_1602_DATA;       //å†™å…¥LCDæ•°æ®
 350   1              LCD_E = 0;
 351   1              LCD_RS = 0;
 352   1      }
 353          
 354          void LCD_WriteCom(uchar LCD_1602_COM)
 355          /* * @brief å‘LCDå†™å…¥å‘½ä»¤
 356           * è¯¥å‡½æ•°ç”¨äºå‘1602å‹å·çš„LCDå†™å…¥æŒ‡å®šçš„å‘½ä»¤ã€‚
 357           * å†™å…¥å‘½ä»¤çš„è¿‡ç¨‹åŒ…æ‹¬ï¼šè®¾ç½®LCDä½¿èƒ½ä¿¡å·ã€è®¾ç½®LCDå‘½ä»¤/æ•°æ®é€‰æ‹©ä¿¡å·ã€
 358           * è®¾ç½®LCDè¯»å†™ä¿¡å·ã€å†™å…¥æ•°æ®å¹¶æ¢å¤åˆå§‹çŠ¶æ€ã€‚
 359           * * @param LCD_1602_COM è¦å†™å…¥LCDçš„å‘½ä»¤å­—èŠ‚
 360           */
 361          {
 362   1              delay5ms();             //æ“ä½œå‰çŸ­æš‚å»¶æ—¶ï¼Œä¿è¯ä¿¡å·ç¨³å®š
 363   1              LCD_E = 0;              //ä½¿èƒ½ç½®ä¸ºä½ç”µå¹³
 364   1              LCD_RS = 0;             //å¯„å­˜å™¨é€‰æ‹©ç½®ä¸ºä½ç”µå¹³ï¼Œè¡¨ç¤ºä¼ è¾“å‘½ä»¤å­—èŠ‚
 365   1              LCD_RW = 0;             //è¯»å†™ç½®ä¸ºä½ç”µå¹³,è¡¨ç¤ºå†™å…¥æ•°æ®
 366   1              _nop_();
 367   1              LCD_E = 1;
 368   1              LCD_DATA = LCD_1602_COM;        //å†™å…¥LCDå‘½ä»¤å­—èŠ‚
 369   1              LCD_E = 0;
 370   1              LCD_RS = 0;
 371   1      }
 372          
 373          void InitLcd()
 374          {
 375   1              delay5ms();
 376   1              delay5ms();
 377   1              LCD_WriteCom(0x38);             //å…«ä½æ•°æ®æ¥å£ï¼Œä¸¤è¡Œæ˜¾ç¤ºï¼Œ5*7ç‚¹é˜µ
 378   1              LCD_WriteCom(0x38); 
 379   1              LCD_WriteCom(0x38); 
 380   1              LCD_WriteCom(0x06);                     //æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡å…³ï¼Œé—ªçƒå…³
 381   1              LCD_WriteCom(0x0c);                     //æ•°æ®è¯»å†™æ“ä½œåï¼Œå…‰æ ‡è‡ªåŠ¨åŠ ä¸€ï¼Œç”»é¢ä¸åŠ¨
 382   1              LCD_WriteCom(0x01);                     //å…‰æ ‡å¤ä½ï¼Œæ¸…å±
 383   1              delay5ms();
 384   1              delay5ms();
 385   1      }
 386          
 387          void delay5ms(void)     //@12.000MHz
 388          {
 389   1              unsigned char data i, j;
 390   1      
 391   1              i = 10;
 392   1              j = 183;
 393   1              do
 394   1              {
 395   2                      while (--j);
 396   2              } while (--i);
 397   1      }
 398          
 399          void Uart_Init(void)    //4800bps@12.000MHz
 400          {
 401   1              PCON |= 0x80;           //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 402   1              SCON = 0x50;            //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 403   1              TMOD &= 0x0F;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 404   1              TMOD |= 0x20;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 405   1              TL1 = 0xF3;                     //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 406   1              TH1 = 0xF3;                     //è®¾ç½®å®šæ—¶é‡è½½å€¼
 407   1              ET1 = 0;                        //ç¦æ­¢å®šæ—¶å™¨ä¸­æ–­
C51 COMPILER V9.60.7.0   MAIN                                                              05/16/2024 02:03:21 PAGE 8   

 408   1              TR1 = 1;                        //å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶
 409   1              EA = 1;                         //æ€»ä¸­æ–­ä½¿èƒ½
 410   1              ES = 1;                         //æ‰“å¼€RI,TIä¸­æ–­
 411   1      }
 412          
 413          void Tim_Init()
 414          {
 415   1              EA = 1;                         //é…ç½®ä¸­æ–­å¯„å­˜å™¨
 416   1              ET0 = 1;
 417   1              ET2 = 1;
 418   1              TMOD = 0x11;            //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 419   1              TH0 = 0xfc;                     //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 420   1              TL0 = 0x18;
 421   1              TH2 = 0xd8;
 422   1              TL2 = 0xf0;
 423   1      }
 424          
 425          void Uart_SendString(char *str) 
 426          {
 427   1          while(*str != '\0') // ç›´åˆ°é‡åˆ°å­—ç¬¦ä¸²ç»“æŸç¬¦'\0'
 428   1              {
 429   2              SBUF = *str++;  // å‘é€å½“å‰å­—ç¬¦å¹¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦
 430   2              while(!TI);     // ç­‰å¾…å‘é€å®Œæˆï¼ŒTI=1è¡¨ç¤ºå‘é€å®Œæ¯•
 431   2              TI = 0;                 // æ¸…é™¤å‘é€ä¸­æ–­æ ‡å¿—ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡å‘é€
 432   2          }
 433   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1170    ----
   CONSTANT SIZE    =    169    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     72      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
